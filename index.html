<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Datasource examples</title>
	<script src="js/require.js"></script>
	<script src="js/requireconfig.js"></script>

<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="jquery" src="./test/../js/lib/jquery-1.9.1.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="jsonpath" src="./test/../js/plugins/jsonpath-0.8.0.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="jqueryui" src="./test/../js/lib/jquery-ui-1.10.1.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="jsrender" src="./test/../js/plugins/jsrender.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="jsrobservable" src="./test/../js/plugins/jquery.observable.js"></script>
<!--required for dynamic form -->
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="widgethelper" src="./test/../js/plugins/widget-helper.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="gridpager" src="./test/../js/plugins/grid-pager.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="uidataview" src="./test/../js/plugins/jquery.ui.dataview.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="uidataviewlocal" src="./test/../js/plugins/jquery.ui.dataviewlocal.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="datasource" src="./test/../js/plugins/jquery.uix.datasource.js"></script></head>

	<link rel="stylesheet" href="css/plugins/jquery-ui-1.10.0.css">
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css">
	<style>
	ul,li{
	padding: 0;
	margin: 0;
	}
	.bs-docs-sidebar{
	  top: 40px;
	}
	
	.bs-docs-sidenav {
		width: 228px;
		margin: 30px 0 0;
		padding: 0;
		background-color: #fff;
		-webkit-border-radius: 6px;
		-moz-border-radius: 6px;
		border-radius: 6px;
		-webkit-box-shadow: 0 1px 4px rgba(0,0,0,.065);
		-moz-box-shadow: 0 1px 4px rgba(0,0,0,.065);
		box-shadow: 0 1px 4px rgba(0,0,0,.065);
	}
	
	.bs-docs-sidenav > li >a {
		display: block;
	  width: 190px \9;
	  margin: 0 0 -1px;
	  padding: 8px 14px;
	  border: 1px solid #e5e5e5;
	}
	.bs-docs-sidenav > li:first-child > a {
		-webkit-border-radius: 6px 6px 0 0;
		-moz-border-radius: 6px 6px 0 0;
		border-radius: 6px 6px 0 0;
	}

.bs-docs-sidenav > li:last-child > a {
	-webkit-border-radius: 0 0 6px 6px;
		-moz-border-radius: 0 0 6px 6px;
			border-radius: 0 0 6px 6px;
}

	
	 
	/* Chevrons */
.bs-docs-sidenav .icon-chevron-right {
  float: right;
  margin-top: 2px;
  margin-right: -6px;
  opacity: .25;
}
.bs-docs-sidenav > li > a:hover {
  background-color: #f5f5f5;
}
.bs-docs-sidenav a:hover .icon-chevron-right {
  opacity: .5;
}
.bs-docs-sidenav .active .icon-chevron-right,
.bs-docs-sidenav .active a:hover .icon-chevron-right {
  background-image: url(../img/glyphicons-halflings-white.png);
  opacity: 1;
}
.bs-docs-sidenav.affix {
  top: 40px;
}
.bs-docs-sidenav.affix-bottom {
  position: absolute;
  top: auto;
  bottom: 270px;
}


	</style>
	
	<script>
	var reader = null;

var data1= [{
  name: "samarjit",
  email: "samarjit@email",
  extra: "extra value"
 },
 {
 name: "tutu",
 email: "tutu@email",
 extra: "extra value2"
 }
];


var data3= [{
  full_name: "samarjit",
  email_id: "samarjit@email",
  extra: "extra value"
 },
 {
 full_name: "tutu",
 email_id: "tutu@email",
 extra: "extra value2"
 }
];

var ds = null;
	require.config({baseUrl: "./test" });
		//require(['jqueryui','datasource', 'jsrobservable','widgethelper', 'gridpager'], 
		$(document).ready(function(){

		reader = new SchemaReader({
			resultFields: [{name: "name",mapping : "name"} , {name: "email", mapping: "email"}]
		});
		
		var res1 = reader.read(data1);
		$("#transformer1").text(JSON.stringify(reader.options.resultFields));
		$("#result1").text(JSON.stringify(res1));
		
		
		reader.options.resultFields = ['name','email'];
		var res2 = reader.read(data1);
		$("#transformer2").text(JSON.stringify(reader.options.resultFields));
		$("#result2").text(JSON.stringify(res2));
		
		reader.options.resultFields = [{name: "name",mapping : "full_name"} , {name: "email", mapping: "email_id"}];
		var res3 = reader.read(data3);
		$("#transformer3").text(JSON.stringify(reader.options.resultFields));
		$("#result3").text(JSON.stringify(res3));
		
		
		var data4 = null;
		$.get("data.txt",function (data){
			data4  = data;
			var reader1 = new SchemaReader();
			reader1.options.datatype="csv";
			reader1.options.resultFields = [{name:"name",mapping: 0}, {name: "email",mapping:2}];
		
			var res4 = reader1.read(data4);
			$("#data4").text(data4); 
			$("#transformer4").text(JSON.stringify(reader1.options.resultFields));
			$("#result4").text(JSON.stringify(res4));
		
		});
		
		var data5 = "sam#sgp#2011!tutu#ind#2012";
		
			reader.options.datatype="csv";
			reader.options.resultFields = [{name:"name",mapping: 0}, {name: "year",mapping:2}];
			reader.options.csvfieldSep = "#";
			reader.options.csvRecordSep = "!";
			var res5 = reader.read(data5);
			$("#data5").text(data5); 
			//$("#transformer5").text(JSON.stringify(reader.options.resultFields));
			$("#result5").text(JSON.stringify(res5));
		
		var data7 = {
			meta1: 'This is meta1',
			myarr: [{
			  full_name: "samarjit",
			  email: "samarjit@email",
			  extra: "extra value"
			 },
			 {
			 full_name: "tutu",
			 email: "tutu@email",
			 extra: "extra value2"
			 }]
		};
		
		reader.options.resultFields = [{ name: 'name', mapping: 'full_name'}, {name:'email'}];
		reader.options.rootList = "myarr";
		reader.options.datatype="json";
		reader.read(data7);
		$("#data7").text(JSON.stringify (data7, null ,3 )); 
		$("#transformer7").text(JSON.stringify(reader.options.resultFields));
		$("#result7").text(JSON.stringify(res7));
		
		var  data6 = [{
			name: "sam",
			email: "sam@email"
	        },
			{name: "tutu", email: "tutu@mail.com"},
			{name: "sammy", email: "s@sammymail.com"}
			];
		var model6 = [ {name: "name", type: "string", capturetype: "text", displaytype: "displayText", label: "Name", searchable: true, isPartOfKey: true, convertToModel: null /*view to model*/, convertToView: null /*model to view*/ 	},
			   {name: "email", type: "string", capturetype: "email", displaytype: "displayText", label: "Email", searchable: true, isPartOfKey: true, convertToModel: null /*view to model*/, convertToView: null /*model to view*/ 	},
				];
		
		
		ds = $.uix.datasource({reader: new SchemaReader(), model: model6 ,rawdata: data6, paging:{limit: 1} });
		
		$(ds).on("dataviewresponse",function(){
			$("#dynresult").text(" ds.result = "+ JSON.stringify( ds.result) );
		});
		
		ds.refresh();
		
		$("#data6").text("var data6 = "+ JSON.stringify(data6, null, 1));
		$("#model6").text("var model6 = "+JSON.stringify(model6,null, 1));
		
		function createDynForm($form, datasource, mode){
			$.each(datasource.options.model, function(i, field){
				// var field = $.grep(datasource.options.model, function (i){ if(i.name == fld.name) return i; });
				var fieldWidgets = $("[data-spine-prop='"+field.name+"']", $form);
				widgetHelper.render($form, field, mode); 
				//fill initial data
				var fieldWidgets = $("[data-spine-prop='"+field.name+"']", $form);
				widgetHelper.setValue(fieldWidgets, datasource.get(field.name));
			
			});
			//update form data when datasource updates
			$(ds).on("dataviewresponse",function(){
				$.each(datasource.options.model, function(i, field){
					var fieldWidgets = $("[data-spine-prop='"+field.name+"']", $form);
					widgetHelper.setValue(fieldWidgets, datasource.get(field.name));
				});
			});
			
		}
		
		$("#mytemplates").load('js/plugins/widgethelper.templates.html', function (){
			createDynForm($("#dynform"), ds, 'edit');
		});
		
		$("#dynform_pager").pager( {source:ds} );
		
		$("#exrun").click(function(){
			var optStr = $("#exoptions").val();
			var dataStr = $("#exdata").val();
			var opt = eval('var d = '+optStr+'; d');
			var res = new SchemaReader( opt);
			var data = dataStr;
			try{
			    data = eval('var d = '+dataStr+'; d');	
			} catch(){}
			$("#exopt").text(JSON.stringify( opt, null, 2) );
			$("#exdatafmt").text(JSON.stringify(data, null, 1));
			$("#exres").text( JSON.stringify(res.read(data)) );
		});
		
		});
	</script>
</head>
<body>
<div class="container-fluid">
  <div class="row-fluid">
   
	<div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav affix">
          <li class="active"><a href="#main"><i class="icon-chevron-right"></i> Main</a></li>
          <li><a href="#example"><i class="icon-chevron-right"></i>Example</a></li>
          <li><a href="#toc1"><i class="icon-chevron-right"></i> SchemaReader</a></li>
          <li><a href="#toc2"><i class="icon-chevron-right"></i> Data mapping shortcut</a></li>
          <li><a href="#toc3"><i class="icon-chevron-right"></i> Data mapping</a></li>
          <li><a href="#toc7"><i class="icon-chevron-right"></i> Non array input</a></li>
          <li><a href="#toc4"><i class="icon-chevron-right"></i> CSV and filtering</a></li>
          <li><a href="#toc5"><i class="icon-chevron-right"></i> Custom text file</a></li>
          <li><a href="#toc6"><i class="icon-chevron-right"></i> Dynamic form</a></li>
        </ul>
      </div>
    <div class="span9 ">
     <div class="section">
		<a name="main"></a>
		<h3>This is a local datasource example.</h3>
		All in one working example : <a href="test/dynamic_form.html">dynamic form + grid and common pager</a>
		</div>
		<h4>
			<a href="https://github.com/samarjit/DatasourceForm/">Original Github repo</a>
		</h4>
		
	 <a name="example"></a>
		<h3 >Try out</h3>
Default options
<pre>
{
	rootList: "data",
	meta: "",
	datatype: "json",
	items: [],
	resultFields: null//[{name: "name",  mapping: "name" /*can be xpath,json path
					  // or javascript function*/}, {name: "email"}]
	,
	csvFieldSep : ",",
	csvRecordSep: "\r\n",
	csvFieldDelimiter: '"'
};
</pre>		
Options:<textarea name="exoptions" id="exoptions" cols="70" rows="10" class="span4">{resultFields: ['full_name','email_id']}
</textarea>
Data: <textarea name="exdata" id="exdata" cols="70" rows="10" class="span5">[{
  full_name: "samarjit",
  email_id: "samarjit@email",
  extra: "extra value"
 },
 {
 full_name: "tutu",
 email_id: "tutu@email",
 extra: "extra value2"
 }]</textarea>
<button id="exrun">Run</button>
<br/>
Code: <pre>
reader = new SchemaReader(<span id="exopt">[options]</span>);
		
var res1 = reader.read(<span id="exdatafmt">[data]</span>);
$("#transformer1").text(JSON.stringify(reader.options.resultFields));
$("#result1").text(JSON.stringify(res1));
</pre>	
<h4>Result</h4>
<pre id="exres"></pre>

			
		
		<a name="toc1"></a>
			<h3>SchemaReader</h3>
			This section shows filtering
			
			Data
			<pre>
var data1= [{
  name: "samarjit",
  email: "samarjit@email",
  extra: "extra value"
 },
 {
 name: "tutu",
 email: "tutu@email",
 extra: "extra value2"
 }
];
			</pre>
	
Transform 1 <br/> reader.options.resultFields:<pre id="transformer1">			</pre>
Result1:		<pre id="result1"></pre>

<a name="toc2">Data Mapping shortcut</a><br/>
Transform 2 <br/> reader.options.resultFields:<pre id="transformer2">			</pre>
Result2:		<pre id="result2"></pre>


<a name="toc3">Data Mapping </a>
<pre>
var data3= [{
  full_name: "samarjit",
  email_id: "samarjit@email",
  extra: "extra value"
 },
 {
 full_name: "tutu",
 email_id: "tutu@email",
 extra: "extra value2"
 }
];
</pre>

Transform 3 Options <br/> reader.options.resultFields:<pre id="transformer3">			</pre>
Result3:		<pre id="result3"></pre>

<a name="toc7" >For data which is not an array returned from server </a> <br/>
The rootList option is used to extract this array. Internally it uses jsonPath to extact the data

Data:
<pre id="data7">
</pre>		
Transform Options <br/> reader.options.resultFields:<pre id="transformer7"></pre>
The associated javascript will be
<pre>
reader.options.resultFields = [{ name: 'name', mapping: 'full_name'}, {name:'email'}];
reader.options.rootList = "myarr";
reader.options.datatype="json";
reader.read(data7);
</pre>
Result <pre id="result7"></pre>


<a name="toc4">CSV Reading with filtering </a> <br/>
Data:
CSV reader is quite powerful one. 
Record delimiter (,) and Record seperator (CR LF or LF or CR).
<pre id="data4">
</pre>		

Transform options <br/> resultFields :<pre id="transformer4"></pre>
Configuring CSV datatype: <pre >reader.options.datatype="csv";</pre>

Result <pre id="result4"></pre>

<a name="toc5">Custom Text or CSV Reading specified field separator (#) and record sep (!) </a> <br/>
Data:
CSV reader with arbritrary record delimiter and arbritary record seperator.
Even records can be optionally enclosed by some arbritrary character (for csv default is &quot;)
<pre id="data5">
</pre>		

Transform options : 
<pre >
reader.options.datatype="csv";
reader.options.resultFields = [{name:"name",mapping: 0}, {name: "year",mapping:2}];
reader.options.csvfieldSep = "#";
reader.options.csvRecordSep = "!";
</pre>

Result <pre id="result5"></pre>



<h3>DataSource</h3>
<a name="toc6">Local datasource </a>
Data6<pre id="data6"></pre>
Model6 <pre id="model6"></pre>

<div class="section" >
Code for DS:
<pre id="dscode">
ds = $.uix.datasource({reader: new SchemaReader(), model: model6 ,rawdata: data6, paging:{limit: 1} });
$(ds).on("dataviewresponse",function(){
	$("#dynresult").text( JSON.stringify( ds.result) );
});
ds.refresh(); //triggers dataviewresponse
</pre>
Dyn Form:
Current Obj <code id="dynresult"></code>
<div id="dynform"></div>
<div id="dynform_pager"></div>
		</div>
		  
    </div><!--span9 fluid-->
	  
  </div><!--row fluid-->
  
</div><!--container fluid-->
 
<div id="mytemplates"></div>
	
</body>
</html>
