<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Datasource Form</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
	<meta property="og:type" content="website" /> 
	<meta name="hostname" content="samarjit.github.io">
	<meta name="twitter:title" property="og:title" itemprop="title name" content="Uniform form control, uniform data interchange format, connected datasource" />

	<meta name="description" content="Create form controls which reads and writes uniform format of data, create datasource and connect to these controls">
	<meta name="twitter:description" property="og:description" itemprop="description" content="Create form controls which reads and writes uniform format of data, create datasource and connect to these controls">
	<script src="js/require.js"></script>
	<script src="js/requireconfig.js"></script>

<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="jquery" src="./test/../js/lib/jquery-1.9.1.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="jsonpath" src="./test/../js/plugins/jsonpath-0.8.0.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="jqueryui" src="./test/../js/lib/jquery-ui-1.10.1.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="jsrender" src="./test/../js/plugins/jsrender.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="jsrobservable" src="./test/../js/plugins/jquery.observable.js"></script>
<!--required for dynamic form -->
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="widgethelper" src="./test/../js/plugins/widget-helper.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="gridpager" src="./test/../js/plugins/grid-pager.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="uidataview" src="./test/../js/plugins/jquery.ui.dataview.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="uidataviewlocal" src="./test/../js/plugins/jquery.ui.dataviewlocal.js"></script>
<script type="text/javascript" charset="utf-8" data-requirecontext="_" data-requiremodule="datasource" src="./test/../js/plugins/jquery.uix.datasource.js"></script></head>

	<link rel="stylesheet" href="css/plugins/jquery-ui.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.css">
	<style>
	ul,li{
	padding: 0;
	margin: 0;
	}
	.bs-docs-sidebar{
	  top: 40px;
	}
	
	.bs-docs-sidenav {
		width: 228px;
		margin: 30px 0 0;
		padding: 0;
		background-color: #fff;
		-webkit-border-radius: 6px;
		-moz-border-radius: 6px;
		border-radius: 6px;
		 
	}
	
	.bs-docs-sidenav > li >a {
		display: block;
	  width: 190px \9;
	  margin: 0 0 -1px;
	  padding: 8px 14px;
	  border-right: 2px solid #fff;
	}
	/* .bs-docs-sidenav > li:first-child > a {
		-webkit-border-radius: 6px 6px 0 0;
		-moz-border-radius: 6px 6px 0 0;
		border-radius: 6px 6px 0 0;
	}
	
	.bs-docs-sidenav > li:last-child > a {
		-webkit-border-radius: 0 0 6px 6px;
			-moz-border-radius: 0 0 6px 6px;
				border-radius: 0 0 6px 6px;
	} */

	
	 
	/* Chevrons */
.bs-docs-sidenav .icon-chevron-right {
  float: right;
  margin-top: 2px;
  margin-right: -6px;
  opacity: .25;
}
.bs-docs-sidenav > li > a:hover {
  background-color: #f5f5f5;
}
.bs-docs-sidenav a:hover .icon-chevron-right {
  opacity: .5;
}
.bs-docs-sidenav li.active a,
.bs-docs-sidenav li.active  a{
  /* background-image: url(https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/img/glyphicons-halflings-white.png); */
  opacity: 1;
 
  border-right-color: red;
}
.bs-docs-sidenav.affix {
  top: 40px;
}
.bs-docs-sidenav.affix-bottom {
  position: absolute;
  top: auto;
  bottom: 270px;
}

section{
	background-color: #EAEBFF;
	padding: 40px;
	margin-bottom: 50px;
}
	</style>
	
	<script>
	var reader = null;

var data1= [{
  name: "samarjit",
  email: "samarjit@email",
  extra: "extra value"
 },
 {
 name: "tutu",
 email: "tutu@email",
 extra: "extra value2"
 }
];


var data3= [{
  full_name: "samarjit",
  email_id: "samarjit@email",
  extra: "extra value"
 },
 {
 full_name: "tutu",
 email_id: "tutu@email",
 extra: "extra value2"
 }
];

var ds = null;
	require.config({baseUrl: "./test" });
		//require(['jqueryui','datasource', 'jsrobservable','widgethelper', 'gridpager'], 
	$(document).ready(function(){

		reader = new SchemaReader({
			resultFields: [{name: "name",mapping : "name"} , {name: "email", mapping: "email"}]
		});
		
		var res1 = reader.read(data1);
		$("#transformer1").text(JSON.stringify(reader.options.resultFields));
		$("#result1").text(JSON.stringify(res1));
		
		
		reader.options.resultFields = ['name','email'];
		var res2 = reader.read(data1);
		$("#transformer2").text(JSON.stringify(reader.options.resultFields));
		$("#result2").text(JSON.stringify(res2));
		
		reader.options.resultFields = [{name: "name",mapping : "full_name"} , {name: "email", mapping: "email_id"}];
		var res3 = reader.read(data3);
		$("#transformer3").text(JSON.stringify(reader.options.resultFields));
		$("#result3").text(JSON.stringify(res3));
		
		
		var data4 = null;
		$.get("data.txt",function (data){
			data4  = data;
			var reader1 = new SchemaReader();
			reader1.options.datatype="csv";
			reader1.options.resultFields = [{name:"name",mapping: 0}, {name: "email",mapping:2}];
		
			var res4 = reader1.read(data4);
			$("#data4").text(data4); 
			$("#transformer4").text(JSON.stringify(reader1.options.resultFields));
			$("#result4").text(JSON.stringify(res4));
		
		});
		
		var data5 = "sam#sgp#2011!tutu#ind#2012";
		
			reader.options.datatype="csv";
			reader.options.resultFields = [{name:"name",mapping: 0}, {name: "year",mapping:2}];
			reader.options.csvFieldSep = "#";
			reader.options.csvRecordSep = "!";
			var res5 = reader.read(data5);
			$("#data5").text(data5); 
			//$("#transformer5").text(JSON.stringify(reader.options.resultFields));
			$("#result5").text(JSON.stringify(res5));
		
		var data7 = {
			meta1: 'This is meta1',
			myarr: [{
			  full_name: "samarjit",
			  email: "samarjit@email",
			  extra: "extra value"
			 },
			 {
			 full_name: "tutu",
			 email: "tutu@email",
			 extra: "extra value2"
			 }]
		};
		
		reader.options.resultFields = [{ name: 'name', mapping: 'full_name'}, {name:'email'}];
		reader.options.rootList = "myarr";
		reader.options.datatype="json";
		var res7 = reader.read(data7);
		$("#data7").text(JSON.stringify (data7, null ,3 )); 
		$("#transformer7").text(JSON.stringify(reader.options.resultFields));
		$("#result7").text(JSON.stringify(res7));
		
		var  data6 = [{
			name: "sam",
			email: "sam@email"
	        },
			{name: "tutu", email: "tutu@mail.com"},
			{name: "sammy", email: "s@sammymail.com"}
			];
		var model6 = [ {name: "name", type: "string", capturetype: "text", displaytype: "displayText", label: "Name", searchable: true, isPartOfKey: true, convertToModel: null /*view to model*/, convertToView: null /*model to view*/ 	},
			   {name: "email", type: "string", capturetype: "email", displaytype: "displayText", label: "Email", searchable: true, isPartOfKey: true, convertToModel: null /*view to model*/, convertToView: null /*model to view*/ 	},
				];
		
		
		ds = $.uix.datasource({reader: new SchemaReader(), model: model6 ,rawdata: data6, paging:{limit: 1} });
		
		$(ds).on("dataviewresponse",function(){
			$("#dynresult").text(" ds.result = "+ JSON.stringify( ds.result) );
		});
		
		ds.refresh();
		
		$("#data6").text("var data6 = "+ JSON.stringify(data6, null, 1));
		$("#model6").text("var model6 = "+JSON.stringify(model6,null, 1));
		
		function createDynForm($form, datasource, mode){
			$.each(datasource.options.model, function(i, field){
				// var field = $.grep(datasource.options.model, function (i){ if(i.name == fld.name) return i; });
				var fieldWidgets = $("[data-spine-prop='"+field.name+"']", $form);
				widgetHelper.render($form, field, mode); 
				//fill initial data
				var fieldWidgets = $("[data-spine-prop='"+field.name+"']", $form);
				widgetHelper.setValue(fieldWidgets, datasource.get(field.name));
			
			});
			//update form data when datasource updates
			$(ds).on("dataviewresponse",function(){
				$.each(datasource.options.model, function(i, field){
					var fieldWidgets = $("[data-spine-prop='"+field.name+"']", $form);
					widgetHelper.setValue(fieldWidgets, datasource.get(field.name));
				});
			});
			
		}
		
		$("#mytemplates").load('js/plugins/widgethelper.templates.html', function (){
			createDynForm($("#dynform"), ds, 'edit');
		});
		
		$("#dynform_pager").pager( {source:ds} );
		
		$("#exrun").click(function(){
			$("#exres").empty();
			var optStr = $("#exoptions").val();
			var dataStr = $("#exdata").val();
			var opt = eval('var d = '+optStr+'; d');
			var res = new SchemaReader( opt);
			var data = dataStr;
			try{
			    data = eval('var d = '+dataStr+'; d');	
			} catch(e){}
			$("#exopt").text(JSON.stringify( opt, null, 2) );
			$("#exdatafmt").text(JSON.stringify(data, null, 1));
			$("#exres").text( JSON.stringify(res.read(data)) );
		});
		
		
		
		
		///demo widgetHelper assumes widgethelper.templates.html has been loaded
			$("#mytemplates").load('js/plugins/widgethelper.templates.html', function (){		
				//slider
				var field = {name: "myslider", label: "My Slider Label", capturetype: "slider"};
				widgetHelper.render($("#slidercontainer"),field, "edit");
				
				$("#btnSliderSetVal1").click(function(){
					widgetHelper.setValue($("[data-spine-prop=myslider]"), $("#slidersetVal").val() );
				});
				$("#btnSliderSetVal2").click(function(){
					widgetHelper.setValue($("[data-spine-prop=myslider]"), 50);
				});
				$("#btnSliderSetVal3").click(function(){
					widgetHelper.setValue($("[data-spine-prop=myslider]"), "12" );
				});
				$("#btnSliderGetVal").click(function(){
					$("#slidergetVal").val( widgetHelper.getValue($("[data-spine-prop=myslider]"))  );
				});
				
				//radio
				
				field = {name: "myradiogroup", label: "My radio Label", capturetype: "radiogroup", widgetData:"{\"floatLeftProp\": \"Y\",\"radioList\":\"[{val: 'Y', label: 'Yes'},{val: 'M', label:'Male' }]\"}"};
				widgetHelper.render($("#radiocontainer"),field, "edit");
				
				$("#btnRdSetVal1").click(function(){
					widgetHelper.setValue($("[data-spine-prop=myradiogroup]"), $("#rdsetVal").val() );
				});
				$("#btnRdSetVal2").click(function(){
					widgetHelper.setValue($("[data-spine-prop=myradiogroup]"), "Y");
				});
				$("#btnRdSetVal3").click(function(){
					widgetHelper.setValue($("[data-spine-prop=myradiogroup]"), "M" );
				});
				$("#btnRdGetVal").click(function(){
					$("#rdgetVal").val( widgetHelper.getValue($("[data-spine-prop=myradiogroup]"))  );
				});
				
				require(["js/plugins/jquery.transfer.js"], function(){ console.log('loaded'); 
					field = {name: "mytransfer", label: "My Transfer Label", capturetype: "transferWidget", widgetData:"{\"unHidePanelData\":\"\",\"onChangeFnName\":\"\",\"onFocusFnName\":\"\",\"datasource\":\"local\",\"localdata\":\"AF,AFGHANISTAN,selected\\nAX,LAND ISLANDS,selected\\nAL,ALBANIA\\nDZ,ALGERIA\"}" };
					widgetHelper.render($("#transfercontainer"),field, "edit");

					
					$("#btnTrSetVal1").click(function(){
						widgetHelper.setValue($("[data-spine-prop=mytransfer]"), $("#trsetVal").val() );
					});
					$("#btnTrSetVal2").click(function(){
						widgetHelper.setValue($("[data-spine-prop=mytransfer]"), "DZ,AL");
					});
					$("#btnTrSetVal3").click(function(){
						widgetHelper.setValue($("[data-spine-prop=mytransfer]"), "DZ" );
					});
					$("#btnTrGetVal").click(function(){
						$("#trgetVal").val( widgetHelper.getValue($("[data-spine-prop=mytransfer]"))  );
					});
					
					
					
					
					field = {name: "mymultisel", label: "My Multisel Label", capturetype: "multiSelect", widgetData:"{\"datasource\":\"remote\",\"unHidePanelData\":\"\",\"onChangeFnName\":\"\",\"onFocusFnName\":\"\",\"localdata\":\"AF,AFGHANISTAN\\nSG,SINGAPORE\\nIN,INDIA,selected\\nAL,ALBANIA,selected\\nDZ,ALGERIA\",\"remoteurl\":\"test/country.txt\"}" };
					widgetHelper.render($("#multiselcontainer"),field, "edit");
					document.getElementsByName("mymultisel")[0].value = 'AF';
					
					
				
					
					$("#btnMsSetVal1").click(function(){
						widgetHelper.setValue($("[data-spine-prop=mymultisel]"), $("#mssetVal").val() );
					});
					$("#btnMsSetVal2").click(function(){
						widgetHelper.setValue($("[data-spine-prop=mymultisel]"), "IN");
					});
					$("#btnMsSetVal3").click(function(){
						widgetHelper.setValue($("[data-spine-prop=mymultisel]"), "AF,AL" );
					});
					$("#btnMsGetVal").click(function(){
						$("#msgetVal").val( widgetHelper.getValue($("[data-spine-prop=mymultisel]"))  );
					});
					
					
					//combined set/get
					$("#btnSetFormData").click(function(){
						var frmCombiDataSet = eval('"use strict"; var d='+$("#frmCombiDataSet").val()+';d');
						$.each(frmCombiDataSet, function(i,v){
							 widgetHelper.setValue($("[data-spine-prop="+i+"]"), v);
						});
					});
					$("#btnGetFormData").click(function(){
						var j = {};
						$("[data-spine-prop]", $("#frmContainer")).filter("[data-spine-type]").each(function(i,v){
							j[$(v).data("spine-prop")] = widgetHelper.getValue($(v))
						});
						$("#frmCombiDataGet").html(JSON.stringify(j,null,3));
					});
				});
				//{"datasource":"remote","unHidePanelData":"","onChangeFnName":"","onFocusFnName":"","localdata":"AF,AFGHANISTAN\nSG,SINGAPORE\nIN,INDIA,selected\nAL,ALBANIA,selected\nDZ,ALGERIA","remoteurl":"country.json"}
			});	
			
			function onScroll(event){
			    var scrollPos = $(document).scrollTop();
			    $('.bs-docs-sidenav a').each(function () {
			        var currLink = $(this);
			        var refElement = $(currLink.attr("href"));
			        if (!!refElement.position() && refElement.position().top <= scrollPos && refElement.position().top + refElement.outerHeight(true) > scrollPos) {
			            $('.bs-docs-sidenav li a').parent().removeClass("active");
			            currLink.parent().addClass("active");
			        }
			        else{
			            currLink.parent().removeClass("active");
			        }
			    });
			}	
			$(document).on('scroll',onScroll);
		});
	</script>
</head>
<body>
<div class="container-fluid">
  <div class="row-fluid">
   
	<div class="col-lg-2 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav affix">
          <li class="active"><a href="#main"><i class="icon-chevron-right"></i> Main</a></li>
          <li><a href="#example"><i class="icon-chevron-right"></i>Try out</a></li>
          <li><a href="#toc1"><i class="icon-chevron-right"></i> SchemaReader</a></li>
          <li><a href="#toc2"><i class="icon-chevron-right"></i> Data mapping shortcut</a></li>
          <li><a href="#toc3"><i class="icon-chevron-right"></i> Data mapping</a></li>
          <li><a href="#toc7"><i class="icon-chevron-right"></i> Non array input</a></li>
          <li><a href="#toc4"><i class="icon-chevron-right"></i> CSV and filtering</a></li>
          <li><a href="#toc5"><i class="icon-chevron-right"></i> Custom text file</a></li>
          <li><a href="#toc6"><i class="icon-chevron-right"></i> Dynamic form</a></li>
          <li><a href="#toc8"><i class="icon-chevron-right"></i> Form Controls Widget</a></li>
        </ul>
      </div>
    <div class="col-lg-10 ">
     <div class="section">
		<a name="main"></a>
		<h3>This is a local datasource example.</h3>
		All in one working example : <a href="test/dynamic_form.html">dynamic form + grid and common pager</a>
		</div>
		<h4>
			<a href="https://github.com/samarjit/DatasourceForm/">Original Github repo</a>
		</h4>
<main id="main">
	<h4>Have you ever faced a situation where different form controls create different data, and reading and writing data to from these form controls need to be controlled using messy scripts? </h4>

	<p>It is common, group of radio buttons creating array data, checkbox creates true/false on/off Y/N different values, and single select creates single string data, while a multi-select creates array data. </p>

	<p>Wouldn't it be nice if all form controls accepted and produced same format of data. If you agree please read on.</p>

	<p>The basis of this Datasource form controls is same format of data structure is produced and consumed by every form control. This makes reading and writing data process common across controls. Controls can be easily added and removed from forms. Even there can be fair amount of backend code which can be common. </p>

	<p>Second comes datasources. The datasource is form control agnostic. Means it will create data in a format which can be linked to a form without having to worry what form control is being used to visualize the data. The form with all the controls can be serialized into a data format which is same as the datasource format.</p>
	
	<p>The same datasource can be plugged into a datagrid view which may contain pagination or a simple table. This data grid can be easily modified to create updatatable rows of data</p>

	<em>Note: This is not a one-way or two-way data binding library like angularjs or knockout or backbone models. Data needs to be read manually and written manually from/to the datasource.</em>
	 
	<p>Data binding is not a problem to implement, in fact one-way data binding should be very trivial to implement since we already have included observable models. If you want to implement data binding you will need to make entire datasource observable, and then in the event handler call `setValue` to all the form controls. However nice effect can be achieved by attaching a datasource with multiple forms. Updating all forms setValue() will result in same data appear in multiple places. We have not implemented data updating automatically, but infrastructure is there to implement one-way data binding. To avoid too many events on a page this was chosen design.</p>
	<p>The library is basically a wrapper around any ui library of your choice. Here in most places we have used jQuery-ui, but you can mix different libraries and create a wrapper which uses the compliant our interchange format. Details of structure of widget can be seen in <a href="#toc8"> Form Controls Widget</a></p>
	<p>As you might have guessed that there will be huge amount of DOM manipulation when we do form view updates. This would have been a major concern if every model update would create a cascade of form updates. But in general there are very few user triggered updates. Some might argue this is prehistoric framework as compared to angularjs or reactjs. But in reality this is very small and very lightweight for browsers. </p>
</main>
<section id="example">
	 <a name="example"></a>
		<h3 >Try out</h3>
Default options
<pre>
{
	rootList: "data",
	meta: "",
	datatype: "json",
	items: [],
	resultFields: null//[{name: "name",  mapping: "name" /*can be xpath,json path
					  // or javascript function*/}, {name: "email"}]
	,
	csvFieldSep : ",",
	csvRecordSep: "\r\n",
	csvFieldDelimiter: '"'
};
</pre>		
Options (Paste transform options from below examples):<br/>

<div class="row-fluid ">
	<div class="span6">
		<textarea name="exoptions" id="exoptions" cols="70" rows="12" class="span12">{resultFields: ['full_name','email_id']}
		</textarea>
	</div>
	<div class="span3">
	<pre>
For JSON

{
resultFields: [
{name:'name', mapping:'full_name'}, 
{name:'email', mapping:'email_id'}
],
datatype: "json"
}


</pre>
	 
	</div>
	<div class="span3"> 
	<pre>
For CSV 
{
resultFields: [
{name:'name', mapping:0}, 
{name:'year', mapping:2}
],
csvFieldSep : "#",
csvRecordSep: "!",
csvFieldDelimiter: '"',
datatype:"csv"
}</pre>
	</div>
</div>



<br/>
Data (Paste CSV or JSON): <br/><textarea name="exdata" id="exdata" cols="70" rows="8" class="span12">[{
  full_name: "samarjit",
  email_id: "samarjit@email",
  extra: "extra value"
 },
 {
 full_name: "tutu",
 email_id: "tutu@email",
 extra: "extra value2"
 }]</textarea>
<br/>
<button id="exrun" class="btn btn-primary btn-large">Run</button>

<h4>Result</h4>
<pre id="exres"></pre>
Generated Code for the above: <pre>
reader = new SchemaReader(<span id="exopt">[options]</span>);
		
var res1 = reader.read(<span id="exdatafmt">[data]</span>);
$("#transformer1").text(JSON.stringify(reader.options.resultFields));
$("#result1").text(JSON.stringify(res1));
</pre>	

</section>
			
<section id="toc1">		
		<a name="toc1"></a>
			<h3>SchemaReader</h3>
			This section shows filtering
			
			Data
			<pre>
var data1= [{
  name: "samarjit",
  email: "samarjit@email",
  extra: "extra value"
 },
 {
 name: "tutu",
 email: "tutu@email",
 extra: "extra value2"
 }
];
			</pre>
	
Transform 1 <br/> reader.options.resultFields:<pre id="transformer1">			</pre>
<h4>Result1</h4>		<pre id="result1"></pre>
</section>


<section id="toc2">
<a name="toc2">Data Mapping shortcut</a><br/>
Transform 2 <br/> reader.options.resultFields:<pre id="transformer2">			</pre>
<h4>Result2</h4>:		<pre id="result2"></pre>

</section>


<section id="toc3">
<a name="toc3">Data Mapping </a>
<pre>
var data3= [{
  full_name: "samarjit",
  email_id: "samarjit@email",
  extra: "extra value"
 },
 {
 full_name: "tutu",
 email_id: "tutu@email",
 extra: "extra value2"
 }
];
</pre>

Transform 3 Options <br/> reader.options.resultFields:<pre id="transformer3">			</pre>
<h4>Result3</h4>		<pre id="result3"></pre>
</section>


<section id="toc7">
<a name="toc7" >For data which is not an array returned from server </a> <br/>
The rootList option is used to extract this array. Internally it uses jsonPath to extact the data

Data:
<pre id="data7">
</pre>		
Transform Options <br/> reader.options.resultFields:<pre id="transformer7"></pre>
The associated javascript will be
<pre>
reader.options.resultFields = [{ name: 'name', mapping: 'full_name'}, {name:'email'}];
reader.options.rootList = "myarr";
reader.options.datatype="json";
reader.read(data7);
</pre>
<h4>Result</h4> <pre id="result7"></pre>
</section>


<section id="toc4">
<a name="toc4">CSV Reading with filtering </a> <br/>
Data:
CSV reader is quite powerful one. 
Record delimiter (,) and Record seperator (CR LF or LF or CR).
<pre id="data4">
</pre>		

Transform options <br/> resultFields :<pre id="transformer4"></pre>
Configuring CSV datatype: <pre >reader.options.datatype="csv";</pre>

<h4>Result</h4> <pre id="result4"></pre>
</section>

<section id="toc5">
<a name="toc5">Custom Text or CSV Reading specified field separator (#) and record sep (!) </a> <br/>
Data:
CSV reader with arbritrary record delimiter and arbritary record seperator.
Even records can be optionally enclosed by some arbritrary character (for csv default is &quot;)
<pre id="data5">
</pre>		

Transform options : 
<pre >
reader.options.datatype="csv";
reader.options.resultFields = [{name:"name",mapping: 0}, {name: "year",mapping:2}];
reader.options.csvFieldSep = "#";
reader.options.csvRecordSep = "!";
</pre>

<h4>Result</h4> <pre id="result5"></pre>
</section>

<section id="toc6">
<h3>DataSource</h3>
<a name="toc6">Local datasource </a>
Data6<pre id="data6"></pre>
Model6 <pre id="model6"></pre>

<div class="section" >
Code for DS:
<pre id="dscode">
ds = $.uix.datasource({reader: new SchemaReader(), model: model6 ,rawdata: data6, paging:{limit: 1} });
$(ds).on("dataviewresponse",function(){
	$("#dynresult").text( JSON.stringify( ds.result) );
});
ds.refresh(); //triggers dataviewresponse
</pre>
Dyn Form:
Current Obj <code id="dynresult"></code>
<div id="dynform" class="ui-helper-clearfix"></div>
<div id="dynform_pager"></div>
		</div>
</section>

<section id="toc8">		
		<div id="widgetcontrol">
			<a name="toc8"></a>
			<h3>Form Control Widgets</h3>
			
			Form controls are a wrapper on top of HTML controls/set of HTML controls/jQuery widgets or any other smart control from any library. 
			This enables all widget controls to have setter and getter in a similar way. Although jquery widgets aim for a similar goal of having unified way to set and get options but it is difficult to 
		    do certain things like loop through all the html elements and get all the values required to be submitted to server. 
		    
		     
		    
		    <h4>Advantages</h4> 
			<div class="row-fluid">
			 	 <ul class="span11" style="margin-left:50px" >
			 		<li>widgetHelper provides the common code for render. Each specific widget is called from widgetHelper</li>
			 		<li>Does not submit hidden field's values that are used to maintain the internal states of widgets</li>
			 		<li>Makes it easy to deal with checkboxes</li>
			 		<li>Makes radio groups as single entity to which value can be set, value can be read back, and any user action on any of the radio button element will be 
			 		     handled within that scope of that element</li>
			 		<li>Display label and control in one box container. From a programmatic perspective its easier to find and highlight label in case of errors or to mark mandtory</li>
			 		<li>Display error messages in proper place even if using jQuery validation plugin which usually appends and it appends in the wrong place usually if its a datepicker.</li>
			 		<li>Provides a provision to display tooltip for any form control</li>
			 		<li>Almost any widget can be wrapped up into a Form control even jQuery transfer widget which a text field and two selectboxes and a few buttons will be 
			 		    present but only one value gets submitted to server just like any other widget</li>
			 		<li>serializing and deserializing of values can be done within each form control</li>
			 		<li>Wraps up multi-selects to produce a comma separated value of selected fields</li>
			 		<li>Setting json data received from server to any form and getting json data from a form is clean so its easier to loop though all the controls and do some validation and then submit that data to server</li>
			 		<li>Preselected items values in a selectbox/combobox even if the rest of the list is loaded via ajax. Initially the actual value is set int he textbox and later 
			 		when the option values are loaded through ajax, then delayed preselection is run to give proper visual apearance of pre-selected items. This also works seemlessly accross selectbox/multiselect/transfer widgets.</li>
			 	</ul>
			</div>
			Lets see the internal structure of the from controls. This will also explain how and why are some things done the way it is done.
			
			This is like a factory method to create all jquery Sliders. But this slider accompanies another text field to show the current value.
			
			<pre>var spineSlider =  {
 		fromElm: null,
 		name: "slider",
 		render: function ($form, field,  mode  ){
 			var html =  $.templates("#tmpl_slider_"+mode).render(field); // can.view("#tmpl_datepicker_"+mode, field);
			$form.append(html);	
			var fieldWidgets = $("[data-spine-prop='disp_"+field.name+"']", $form);
			var opts = (field.widgetData!=null)?$.parseJSON(field.widgetData)||{}:{};
			
			fieldWidgets.slider(opts);
			var fieldWidgetsElm = $("[data-spine-prop='"+field.name+"']", $form);
			var that = this;
			fieldWidgets.on("slidechange",function(e,v){
				fieldWidgetsElm.val( $(this).slider("value"));
			});
			
			fieldWidgetsElm.on("change", function(e,v){
				$(this).parent().find("[data-spine-prop='disp_"+$(this).data("spine-prop")+"']").data('ui-slider').value(this.value);
			});
			
			fieldWidgets.trigger("slidechange");
 		},
 		getValue: function($el){
 			return $el.val();//$el.data('ui-slider').value();;
 		},
 		setValue: function($el, val){
 			if($.type(val) != "number"){
 				try{
 					val = parseInt(val);
 				}catch(e){
 					val = -1;
 				}
 			}
 				
 			$el.val(val);
 			$el.trigger("change");
 		},
 		showError: function($el){
 			
 		},
 		showTooltip: function($el){
 			
 		}
 	};
			</pre> 
			Template
			<pre>
&lt;script type="text/template" id="tmpl_datepicker_edit">
&lt;div class="fieldbox">	
   &lt;label for="{{:name}}" class="field-label">{{:label}}

	{{if mandatoryDecorate == 'Y'}}
	&lt;span style='color:red' >&lt;strong>*&lt;/strong>&lt;/span>
	{{/if}}
	&lt;/label>
   &lt;div type="text" name="disp_{{:name}}" data-spine-prop="disp_{{:name}}" data-spine-type="slider" style="width:150px;display: inline-block"  value="Field Details" >&lt;/div>
   
   &lt;input type="text"name="{{:name}}" data-spine-prop="{{:name}}" data-spine-type="slider" size="2" maxlength="10" />

   &lt;div class="error-container">&lt;/div>
&lt;/div>
&lt;/script>

&lt;/script>
			</pre>
			
			
			<h5 class="lead">
				This is a simple widget wrapper of a normal jquery Slider. 
				<small>A few interesting things can be seen here.</small>
			</h5>
				 <br/>
			
			<dl class="span10 dl-horizontal">
				<dt>* Slider + its label</dt> 
				<dd>Slider + its label forms the control. So div.fieldbox can be put anywhere and it will display correctly along with its label. This helps a lot in creating dynamic forms.
					Web frameworks like struts also advocates it <code>&lt;sj:datepicker label="Birth Date" name="dob" /></code>.</dd>
				
				 
					<dt>* Error container </dt><dd>
						is predefined so error will always display in the right place. 
						 If jquery validation plugin and jquery transfer plugin is used, which has two select boxes and an optional search box. 
						 The error label appended by jquery validation can appear in some very odd places.
						 If jquery validation is used with jquery datepicker plugin normally the error label crops up in between the textfield and the calendar icon making GUI look horrible, this situation can be avoided here. 
						 
						 Another possibility this "error-container" offers is to wrap the error into a javascript tooltip. In that case <code>showError()</code> function needs to be used to render the error.
						
						 <i>Note: Struts 2 framework has templates in server side that gets rendered, but no error container. They do client side validation much like jquery validation plugin. Struts 2 does well for
						 normal containers but as soon as transfer widgets comes their error system goes haywire. It validates the wrong element-1 and shows error messages attached to the wrong element-2 (horrible)
<pre>&lt;s:optiontransferselect
    label="Lucky Numbers"
    name="leftNumber"
    list="{'1 - One ', '2 - Two', '3 - Three', '4 - Four', '5 - Five'}"
    doubleName="rightNumber"
    doubleList="{'10 - Ten','20 - Twenty','30 - Thirty','40 - Forty','50 - Fifty'}"
/></pre> 
						 </i>
					</dd>
				 
				<dt> Main element</dt> 
				<dd>
					* Main element of any widget is the [data-spine-prop] and [data-spine-type]. It is mandatory to have an element/div with these two properties.  
					  This enables to loop through all the elements of a form that correspond to an from control. This makes sure that sub elements within a control are never parsed while getting values in a generic way.
					  
					 <code> $("*[data-spine-prop]")</code> //will correctly get all the widgets in a form.
					  All set value and get value should refer these HTML elements only.
					  
					  <pre>
$("*[data-spine-prop]").each(function(i,v){ //loops through all the elements
 	var val = widgetHelper.getValue($(v));
 	console.log( val );
 });
					  </pre>
				</dd>
				
				<dt>Validation</dt>  
				<dd>* Validation should be done based on the main element. The problem faced by struts2 above can be easily addressed by using main element concept and error container concept. 
					  I dont know why they missed it. </dd>
				<dt>Unified way to set and get</dt>
				<dd>* Unified way to set and get value is achieved like this. Any elements to show only display properties, internal states are all ignored while dealing with form data.</dd>
				 
				<dt>render() </dt> 
				<dd>* render() function is supposed to render the template and set up the change events within the widget. 
						In this spider widget to show current value one text field is used appended right next to the slider to show its current value. DOM Events needs to be set up to synchronize the text field's values and the slider values.
						A change can be triggered by user while doing the sliding. 
						A change can be triggered by setting value on that slider from another javascript function. It is well knows that setting by javscript does not automatically fires a "change" event. So this is the place to set that up. 
					</dd>
				<dt>setValue()</dt>
				<dd>* setValue() is used to set value. It also is used to set different forms of a value. For example. In the above Slider both number and text can be set on that value.
					  There is a possibility to show error state of widget in the error container as well.</dd>
				
				<dt>getValue()</dt>
				<dd>* getValue() is used to get a value from a widget control. Additional serialization of internal state can be done here. 
					  
					  
					<code>widgetHelper.setValue($el, '30'); </code><br/>
						<code> var retDate = widgetHelper.getValue($el);</code></dd>
			</dl>
			<div style="clear: left"> <br/></br></div>			
			<p  >
				Some concepts turned out to be similar to <a href="https://github.com/mleibman/SlickGrid/wiki/Writing-custom-cell-editors">https://github.com/mleibman/SlickGrid/wiki/Writing-custom-cell-editors</a>
				<br/>Ex.<a href="http://mleibman.github.io/SlickGrid/examples/example3-editing.html">http://mleibman.github.io/SlickGrid/examples/example3-editing.html</a>,
				<a href="http://mleibman.github.io/SlickGrid/examples/example3a-compound-editors.html">http://mleibman.github.io/SlickGrid/examples/example3a-compound-editors.html</a> </br>
			</p>
			
			<style>
			.fieldbox {
			    width: 400px;
				float:left
			} 
.fieldbox label {
float: left;
display: inline-block;
font-weight: bold;
}
label.field-label {
width: 50%;
font-family: arial;
display: inline-block;
box-sizing: border-box;
}
			</style>
			<form action="#" id="frmContainer">
				<h5>Setting all Values</h5>
				<div class="row-fluid">
					<div class="span6">
				<textarea name="frmCombiDataSet" id="frmCombiDataSet" cols="30" rows="10">
{
myslider: 31, 
myradiogroup: 'M', 
mytransfer: 'DZ,AL', 
mymultisel: 'IN,SG'
}					
				</textarea>
						<button type="button" id="btnSetFormData" class="btn btn-active btn-small" >Set json</button>
						 
					</div>
					<div class="span6">
<pre>$("#btnSetFormData").click(function(){
	var frmCombiDataSet = eval('"use strict"; var d='+$("#frmCombiDataSet").val()+';d');
	$.each(frmCombiDataSet, function(i,v){
		 widgetHelper.setValue($("[data-spine-prop="+i+"]"), v);
	});
});</pre>
					</div>
				</div>
				<h5>Getting all Values</h5>				
				<div class="row-fluid">	
					<div class="span6">
						<button type="button" id="btnGetFormData" class="btn btn-active btn-small" >Get json</button>
						<pre id="frmCombiDataGet"></pre>
					</div>
					<div class="span6">
<pre>var j = {};
$("[data-spine-prop]", $("#frmContainer")).filter("[data-spine-type]").each(function(i,v){
	j[$(v).data("spine-prop")] = widgetHelper.getValue($(v))
});
$("#frmCombiDataGet").html(JSON.stringify(j,null,3));
</pre>
					</div>
				</div>	
				<div class="row-fluid">
					<div class="span12">
						<h4>Example Slider</h4>
<pre>var field = {name: "myslider", label: "My Slider Label", capturetype: "slider"};
widgetHelper.render($("#slidercontainer"),field, "edit");</pre>
						
					</div>
				</div>
				<div class="row-fluid">
					<div class="span6"><div id="slidercontainer" style="border:1px solid lightgrey; padding: 10px" class="ui-helper-clearfix"></div></div>
					<div class="span6">
						widgetHelper.setValue($("[data-spine-prop=myslider]"), ...): <input type="text"  value="20" id="slidersetVal" /> <button type="button" class="btn btn-small" id="btnSliderSetVal1">setValue()</button> <br/>
						widgetHelper.setValue($("[data-spine-prop=myslider]"),50) :  <button type="button" class="btn btn-small" id="btnSliderSetVal2">setValue()</button> <br/>
						widgetHelper.setValue($("[data-spine-prop=myslider]"),"12") <span class="muted">data conversion</span>:  <button type="button" class="btn btn-small" id="btnSliderSetVal3">setValue()</button> <br/>
						widgetHelper.getValue($("[data-spine-prop=myslider]")): <button type="button" id="btnSliderGetVal" class="btn btn-small" >getValue()</button> <input type="text" id="slidergetVal"  /> <br/>
						
					</div>
				</div>
				<div class="row-fluid">
					<div class="span12">
						<h4>Example radio group</h4>
<pre>var field = {name: "myradiogroup", label: "My radio Label", capturetype: "radiogroup", widgetData:"{\"floatLeftProp\": \"Y\",\"radioList\":\"[{val: 'Y', label: 'Yes'},{val: 'M', label:'Male' }]\"}"};

widgetHelper.render($("#radiocontainer"),field, "edit");</pre>
					</div>
				</div>
				<div class="row-fluid">
					<div class="span6"><div id="radiocontainer"  style="border:1px solid lightgrey; padding: 10px" class="ui-helper-clearfix"></div></div>
					<div class="span6">
						
						widgetHelper.setValue($("[data-spine-prop=myradiogroup]"), ...): <input type="text"  value="M" id="rdsetVal" /> <button type="button" class="btn btn-small" id="btnRdSetVal1">setValue()</button> <br/>
						widgetHelper.setValue($("[data-spine-prop=myradiogroup]"),"Y") :  <button type="button" class="btn btn-small" id="btnRdSetVal2">setValue()</button> <br/>
						widgetHelper.setValue($("[data-spine-prop=myradiogroup]"),"M") : <button type="button" class="btn btn-small" id="btnRdSetVal3">setValue()</button> <br/>
						widgetHelper.getValue($("[data-spine-prop=myradiogroup]")): <button type="button" id="btnRdGetVal" class="btn btn-small" >getValue()</button> <input type="text" id="rdgetVal"  /> <br/>
						
					</div>
				</div>
				<div class="row-fluid">
					<div class="span12">
						<h4>Example Transfer Widget</h4>
<pre>field = {name: "mytransfer", label: "My Transfer Label", capturetype: "transferWidget", 
widgetData:"{\"unHidePanelData\":\"\",\"onChangeFnName\":\"\",\"onFocusFnName\":\"\",\"datasource\":\"local\",\"localdata\":\"AF,AFGHANISTAN,selected\\nAX,LAND ISLANDS,selected\\nAL,ALBANIA\\nDZ,ALGERIA\"}" };

widgetHelper.render($("#radiocontainer"),field, "edit");</pre>
					</div>
					
				</div>
				<div class="row-fluid">
					<div class="span6"><div id="transfercontainer"  style="border:1px solid lightgrey; padding: 10px" class="ui-helper-clearfix"></div></div>
					<div class="span6">
						
						widgetHelper.setValue($("[data-spine-prop=myradiogroup]"), ...): <input type="text"  value="DZ,AF" id="trsetVal" /> <button type="button" class="btn btn-small" id="btnTrSetVal1">setValue()</button> <br/>
						widgetHelper.setValue($("[data-spine-prop=myradiogroup]"),"DZ,AL") :  <button type="button" class="btn btn-small" id="btnTrSetVal2">setValue()</button> <br/>
						widgetHelper.setValue($("[data-spine-prop=myradiogroup]"),"AL") :  <button type="button" class="btn btn-small" id="btnTrSetVal3">setValue()</button> <br/>
						widgetHelper.getValue($("[data-spine-prop=myradiogroup]")): <button type="button" id="btnTrGetVal" class="btn btn-small" >getValue()</button> <input type="text" id="trgetVal"  /> <br/>
						
					</div>
				</div>
				
				<div class="row-fluid">
					<div class="span12">
						<h4>Example Multi-select Widget <small>Ajax + delayed preselect</small></h4>
				
<pre>field = {name: "mymultisel", 
label: "My Multisel Label", 
capturetype: "multiSelect", 
widgetData:"{\"datasource\":\"remote\",\"unHidePanelData\":\"\",\"onChangeFnName\":\"\",\"onFocusFnName\":\"\",\"localdata\":\"AF,AFGHANISTAN\\nSG,SINGAPORE\\nIN,INDIA,selected\\nAL,ALBANIA,selected\\nDZ,ALGERIA\",\"remoteurl\":\"test/country.txt\"}" };

widgetHelper.render($("#multiselcontainer"),field, "edit");
//-->To simulate that value was set after form was rendered but before the country.txt would have been loaded by ajax.
document.getElementsByName("mymultisel")[0].value = 'AF'; 
//Thus to highlight AF delayed preselection is working
//The other two selected items(IN,AL) are marked as "selected" in country.txt itself
</pre>
					</div>
				</div>
				<div class="row-fluid">
					<div class="span6"><div id="multiselcontainer"  style="border:1px solid lightgrey; padding: 10px" class="ui-helper-clearfix"></div></div>
					<div class="span6">
						
						widgetHelper.setValue($("[data-spine-prop=mymultisel]"), ...): <input type="text"  value="SG" id="mssetVal" /> <button type="button" class="btn btn-small" id="btnMsSetVal1">setValue()</button> <br/>
						widgetHelper.setValue($("[data-spine-prop=mymultisel]"),"IN") :  <button type="button" class="btn btn-small" id="btnMsSetVal2">setValue()</button> <br/>
						widgetHelper.setValue($("[data-spine-prop=mymultisel]"),"AF,AL") :  <button type="button" class="btn btn-small" id="btnMsSetVal3">setValue()</button> <br/>
						widgetHelper.getValue($("[data-spine-prop=mymultisel]")): <button type="button" id="btnMsGetVal" class="btn btn-small" >getValue()</button> <input type="text" id="msgetVal"  /> <br/>
						
					</div>
				</div>
			</form>
		</div>
		</section>  

		<!-- disqus start-->
		<div id="disqus_thread"></div>
		<script>
		    /**
		     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
		     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
		     */
		    
		    var disqus_config = function () {
		        this.page.url = 'http://samarjit.github.io/DatasourceForm/';  // Replace PAGE_URL with your page's canonical URL variable
		        this.page.identifier = 'DatasourceForm'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
		    };
		    
		    (function() {  // DON'T EDIT BELOW THIS LINE
		        var d = document, s = d.createElement('script');
		        
		        s.src = '//datasourceform.disqus.com/embed.js';
		        
		        s.setAttribute('data-timestamp', +new Date());
		        (d.head || d.body).appendChild(s);
		    })();
		</script>
		 
		<script id="dsq-count-scr" src="//datasourceform.disqus.com/count.js" async></script>
		<a href="hhttp://samarjit.github.io/DatasourceForm/index.html#disqus_thread">Link</a>
		<!-- disqus end-->


    </div><!--span9 fluid-->
	  
  </div><!--row fluid-->
  
</div><!--container fluid-->
 
<div id="mytemplates"></div> <!--contains dynamically generated tempaltes of form-controls-->


 

</body>
</html>
